# 下一步开发计划（SLAIS 项目）

## 1. 主流程完善与自动化
- [ ] 完善 `main.py`，实现完整的端到端流程（PDF解析→元数据获取→图片分析→LLM分析→报告生成）。
- [ ] 增加命令行参数支持（如指定PDF路径、输出目录、分析选项等）。
- [ ] 支持批量处理多个PDF文件。

## 2. 测试体系建设
- [ ] 搭建 `tests/` 目录结构，区分单元测试与集成测试。
- [ ] 针对 `slais/pdf_utils.py`、`agents/llm_analysis_agent.py` 等核心模块编写基础单元测试。
- [ ] 引入 `pytest`、`pytest-mock`，实现API调用的mock，保证测试可重复、无外部依赖。
- [ ] 集成代码覆盖率工具（如 `pytest-cov`）。

## 3. 报告与输出优化
- [ ] 报告生成支持多格式（Markdown、HTML、PDF）。
- [ ] 优化图片路径、样式和相对引用，保证报告可移植性。
- [ ] 增加报告内容的可配置性（如选择输出哪些分析模块）。
- [ ] **美化Markdown报告格式**：  
      - 统一使用表格、折叠区域、分割线等结构化元素。
      - 增加目录、章节锚点、页眉页脚和LOGO等视觉元素。
      - 优化字体、配色、间距和层级，提升可读性。
      - 支持自定义CSS样式块，兼容Typora、Obsidian等主流Markdown阅读器。
- [ ] **增强交互性**：  
      - 支持折叠/展开详情（如方法学、创新点、问答等）。
      - 图片支持缩略图预览和点击放大。
      - Mermaid脑图自动格式化，保证在主流Markdown工具中可直接渲染。
- [ ] **可维护性与扩展性**：  
      - 报告生成逻辑模块化，便于后续扩展（如增加新分析模块）。
      - 支持多语言报告模板切换。
      - 输出结构与样式分离，便于主题定制。

## 4. LLM与API调用增强
- [ ] 支持多模型配置与切换（如Qwen、OpenAI、Claude等）。
- [ ] 增加LLM调用的异常处理、自动重试和降级策略。
- [ ] 记录和统计LLM调用的token消耗与成本。
- [ ] 支持token消耗与成本的可视化统计和报告输出。

## 5. 缓存与性能
- [ ] 完善 `CacheManager`，支持API响应和LLM分析结果的持久化缓存。
- [ ] 针对大文件和重复任务优化缓存命中率。
- [ ] 支持缓存清理和过期策略配置。

## 6. 用户体验与交互
- [ ] 增加进度条、日志输出和错误提示，提升用户体验。
- [ ] 设计简单的Web界面或CLI交互界面（可选，后续实现）。
- [ ] 支持任务队列和批量任务进度管理.

### Web界面设计指导建议

#### 1. 技术选型对比与推荐

根据主流纯Python Web框架对比（见附图），结合SLAIS项目需求（科研工具、文件上传、进度/日志、报告预览、易维护、低门槛），推荐如下：

- **首选：Streamlit**
  - **优点**：启动简单、代码量少、社区成熟、支持文件上传、进度条、日志输出、Markdown/图片/表格渲染，适合快速原型和科研工具。
  - **缺点**：启动速度较慢，交互性和自定义程度有限，适合单用户/轻量场景。
  - **适用场景**：快速原型、个人/小团队科研分析、无需复杂前端开发。
- **备选：NiceGUI**
  - **优点**：启动快，支持响应式、现代UI，基于FastAPI+Vue，适合需要更丰富交互和更快响应的场景。
  - **缺点**：内存占用中等，生态不如Streamlit成熟，学习曲线略高。
  - **适用场景**：需要更复杂交互、后续考虑多用户/权限、希望前后端分离时。
- **其他框架（Panel、Dash、Reflex等）**：适合仪表盘、企业级可视化或SaaS，SLAIS当前阶段不建议优先考虑。

**结论**：SLAIS建议优先用Streamlit实现MVP，后续如需更高性能或复杂交互可迁移到NiceGUI或前后端分离架构。

#### 2. 界面布局建议
- **顶部导航栏**：显示项目LOGO、系统名称（SLAIS）、快速导航按钮（如“上传PDF”、“历史报告”、“设置”）。
- **主操作区**：
  - **文件上传**：支持拖拽或选择PDF文件，显示文件名、大小、上传进度。
  - **参数设置**：可选项，如DOI、分析模块选择、最大问题数等。
  - **任务启动按钮**：点击后触发分析流程，禁用按钮防止重复提交。
- **进度与日志区**：
  - **进度条**：实时显示当前分析进度（如“PDF解析→元数据获取→图片分析→LLM分析→报告生成”）。
  - **实时日志输出**：滚动显示关键日志、错误提示、警告信息，便于用户追踪任务状态。
- **结果展示区**：
  - **报告预览**：直接渲染Markdown报告，支持折叠、目录跳转、图片缩放等交互。
  - **下载按钮**：一键下载Markdown、HTML、PDF等格式的报告和CSV数据。
  - **历史任务列表**：展示历史分析记录，支持查看、下载、删除。

#### 3. 交互细节建议
- **错误提示**：分析失败时弹窗或高亮显示错误信息，指引用户修正（如缺少DOI、API Key无效等）。
- **任务队列**：支持批量上传PDF，显示每个任务的独立进度和状态（排队、进行中、已完成、失败）。
- **多用户支持**（可选）：后续可扩展为多用户系统，支持登录、个人历史、权限管理等。
- **移动端适配**：界面自适应，保证在手机/平板上也能流畅使用。

#### 4. 开发建议
- **组件化**：将上传、进度、日志、报告预览等功能拆分为独立组件，便于维护和扩展。
- **异步任务**：后端分析流程采用异步/多进程，避免界面卡顿，支持长时间任务。
- **API设计**：前后端通过RESTful或WebSocket接口通信，便于后续与CLI、第三方系统集成。
- **美观性**：采用现代UI风格，配色简洁，适当使用图标、动画提升体验。
- **可扩展性**：预留自定义主题、国际化、插件扩展等能力。

#### 5. 推荐实现步骤
1. **首选Streamlit**：用最少代码实现文件上传、参数设置、进度条、日志、报告预览和下载，快速上线。
   - 已实现初版 Streamlit Web 界面（见 web_app.py），支持PDF上传、参数设置、分析进度、报告预览与下载。
2. **如需更高性能/复杂交互**：评估NiceGUI，逐步迁移，利用其响应式和多端支持。
3. **后续升级**：如需多用户、权限、任务队列等，考虑FastAPI+Vue/React等前后端分离方案。
4. **持续收集用户反馈，优化体验和性能。**

---

## 7. 文档与规范
- [ ] 完善开发文档和模块注释，保持中英文双语。
- [ ] 更新 `project.md`，同步架构、流程和最佳实践。
- [ ] 编写详细的环境部署和运行说明。
- [ ] 提供典型用例和FAQ文档.

## 8. 未来扩展预研
- [ ] 预研多语言支持与国际化。
- [ ] 规划知识图谱、可视化分析等高级功能。
- [ ] 关注新兴大模型API的集成可能性。
- [ ] 研究与学术搜索引擎、数据可视化平台的深度集成.

---

*请团队成员根据上述计划认领任务，及时同步进展。每阶段完成后，回顾总结并调整后续优先级。*
