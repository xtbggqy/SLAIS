# LLM 提示模板 (Prompt Templates)

# 本文件定义了用于SLAIS系统中各类LLM分析任务的提示模板。
# 每个模板都旨在清晰地指导大语言模型生成特定格式和内容。
# {content} 占位符通常会填充完整的文献文本。
# {image_analysis} 占位符会填充图片内容的结构化描述。
# TokenUsageCallbackHandler (位于 agents/callbacks.py) 会负责计算总输入Token数量。

METHODOLOGY_ANALYSIS_PROMPT = """
请分析以下文献内容（包括图片分析结果），并以 Markdown 格式返回对研究方法的详细评估。
请确保输出结构清晰，包含以下明确的标题和内容：

## 研究方法评估

### 方法类型
- 描述研究所属的方法类型，例如 "实验研究"、"计算模拟"、"综述"、"理论分析"、"混合方法" 等。

### 关键技术
- 列出研究中使用的关键技术、算法或实验手段。

### 数据来源
- 描述数据来源，例如 "公共数据集"、"自行采集"、"模拟生成" 等。

### 样本量描述 (如果适用)
- 如果研究涉及样本量或数据集规模，请进行描述。

### 方法优点
- 分析该研究方法的优点。

### 方法局限性
- 分析该研究方法的潜在局限性。

### 方法创新点
- 识别并描述研究方法中的创新点。

文献内容：
{content}

图片内容分析（如有）：
{image_analysis}

请严格按照上述 Markdown 格式输出。
"""

INNOVATION_EXTRACTION_PROMPT = """
请仔细阅读以下文献内容（包括图片分析结果），并以 Markdown 格式提取其核心创新点和潜在应用。
请确保输出结构清晰，包含以下明确的标题和内容：

## 核心创新与应用前景

### 核心创新点
- 列出文献的主要创新贡献。

### 解决的问题
- 描述文献试图解决的核心问题。

### 与现有工作相比的新颖性
- 阐述本研究与现有工作相比，其新颖之处和突破性。

### 潜在应用
- 列出这些创新的潜在应用领域或场景。

### 未来研究方向
- 文献中暗示或明确提出的未来研究方向。

文献内容：
{content}

图片内容分析（如有）：
{image_analysis}

请严格按照上述 Markdown 格式输出。
"""

QA_GENERATION_PROMPT = """
请根据以下文献内容（包括图片分析结果），生成 {num_questions} 个高质量、具有深度和启发性的问题。
这些问题应覆盖文献的核心概念、关键发现、研究方法、数据解读、创新点、局限性及未来展望等方面，能够引导深入理解和批判性思考。
请以 Markdown 列表格式输出，每个问题前加 `- `，问题应简明、具体、与文献内容紧密相关，避免泛泛而谈。

例如：
- 该研究提出的主要创新点是什么？
- 文献采用了哪些关键实验方法？其优缺点分别是什么？
- 研究结果在实际应用中可能面临哪些挑战？
- 作者如何解释实验数据中的异常现象？
- 未来研究可以在哪些方向进一步拓展？

文献内容：
{content}

图片内容分析（如有）：
{image_analysis}

请确保所有问题均基于文献内容，具有针对性和启发性，避免重复和表述模糊。
"""

# ANSWER_GENERATION_PROMPT (单个问题回答，目前主要使用批量回答，此模板可作为备用或参考)
# 请根据以下文献内容（包括图片分析结果），回答以下问题。
#
# 问题：{question}
#
# 文献内容：
# {content}
#
# 图片内容分析（如有）：
# {image_analysis}
#
# 请直接给出答案，不需要重复问题。

BATCH_ANSWER_GENERATION_PROMPT = """
请根据以下文献内容（包括图片分析结果），为下面列出的每一个问题提供一个内容完善、信息充分、准确且具有参考价值的答案。
每个答案应涵盖问题相关的核心要点，必要时可适当补充背景、细节或例证，使回答具有完整性和权威性。
请以一个 JSON 列表的格式返回结果，其中每个元素是一个包含 "question" 和 "answer" 键的字典。
确保 JSON 格式严格正确无误，并且每个问题的文本与此处提供的完全一致。
文献内容：
{content}

图片内容分析（如有）：
{image_analysis}

问题列表 (请为这些问题生成答案，并确保在输出的JSON中，每个问题的文本与此处提供的完全一致)：
{questions_json_list_string}

重要提示：请只输出 JSON 内容，不要包含任何额外的解释性文字、Markdown 代码块标记（如```json）或任何其他非JSON文本。

例如:
"question": "问题1的文本", "answer": "答案1的文本",
"question": "问题2的文本", "answer": "答案2的文本"
请严格按照上述 JSON 格式输出所有问答对，确保每个答案内容详实、完善。
"""

STORYTELLING_PROMPT = """
请将以下文献内容（包括图片分析结果）用讲故事的方式生动地讲述出来。
故事应该引人入胜、通俗易懂，同时不失专业性和准确性，能够清晰地传达文献的核心思想、研究背景、过程、主要发现和重要意义。
请避免使用过于晦涩的技术术语，或者在必要时进行简洁明了的解释。

文献内容：
{content}

图片内容分析（如有）：
{image_analysis}

请以流畅的叙述体 Markdown 格式返回故事。
"""

MINDMAP_PROMPT = """
请根据以下文献内容（包括图片分析结果），生成一个概括全文逻辑结构的 Mermaid 格式的脑图（思维导图）。
脑图应清晰地展示文献的主要章节、关键概念、研究流程或论证结构。
请确保输出是有效的 Mermaid 语法代码块。

例如：
```mermaid
graph TD
    A[文献标题] --> B(引言)
    B --> C[研究问题]
    C --> D[方法]
    D --> E[结果]
    E --> F[讨论]
    F --> G[结论]
```

文献内容：
{content}

图片内容分析（如有）：
{image_analysis}

请只返回 Mermaid 代码块，不要包含额外的解释文本。
"""

DEEP_ANALYSIS_PROMPT = """
请基于以下主要文献内容、其图片分析结果、参考文献摘要以及相关文献摘要，进行一次深入的综合分析。
分析报告应以 Markdown 格式呈现，并包含以下几个方面：

## 文献深度分析报告

### 1. 研究背景与动机的综合视角
- 结合所提供的参考文献和相关文献信息，更全面和深入地阐述当前研究的动机、所处的学术背景以及试图解决的核心科学问题。

### 2. 方法论的比较与评述 (如适用)
- 审视当前文献的研究方法。如果参考文献或相关文献中存在针对相似问题的不同研究方法，请进行简要的比较和评述，指出各自的优劣和适用场景。

### 3. 研究结果的印证、拓展与矛盾
- 分析参考文献和相关文献的结果，它们是如何支持、反驳、补充或拓展当前文献的主要发现的？是否存在不一致或矛盾之处？

### 4. 领域内的定位与独特贡献评估
- 综合所有信息（主要文献、参考文献、相关文献），评估当前文献在其特定研究领域的具体定位。
- 它填补了哪些研究空白？其最独特或最重要的贡献是什么？

### 5. 综合性未来展望与未决问题
- 基于对当前文献及其学术上下文（参考文献和相关文献）的理解，提出更深层次的、尚未解决的关键问题。
- 展望该领域未来可能出现的新研究方向或有前景的探索路径。

---

**主要文献内容：**
{content}

---
**主要文献图片内容分析（如有）：**
{image_analysis}

---
**主要文献的参考文献摘要（格式：[序号] 作者 (年份). 标题. 期刊. DOI/PMID (如有)）：**
{references_summary}

---
**相关文献摘要（格式：作者 (年份). 标题. 期刊. DOI/PMID (如有)）：**
{related_articles_summary}

---

### 6. 参考文献
- 请在分析报告最后，输出本次分析中引用的所有参考文献，格式必须严格遵循Nature期刊的参考文献格式（作者. 文章标题. 期刊名 卷号, 起止页码 (年份). DOI/PMID（如有））。
- 仅列出在分析报告正文中实际引用的文献，并在正文中以上标数字引用（如^1^、^2^等）。

请确保分析的深度和广度，并以清晰、结构化的 Markdown 格式返回报告，正文和参考文献格式均严格符合要求。
"""

# 图片内容分析基础提示词
IMAGE_ANALYSIS_BASE_PROMPT = """
请对学术论文中的图片进行简洁、准确的内容分析。对于每张图片，请提供以下结构化信息：

1.  **图片类型**: 明确指出是图表（如柱状图、折线图、散点图）、照片、流程图、示意图、表格还是其他类型。
2.  **主要内容描述**: 简洁描述图片展示的关键信息、元素、趋势或模式。重点包括：
    *   图表：坐标轴含义、数据趋势、关键数据点。
    *   照片：主要对象和重要细节。
    *   流程图：主要步骤和关系。
3.  **主要发现或结论**: 简要提炼图片所支持的主要研究发现或结论。
4.  **与文献内容的关联**: 简要说明图片在文献中的作用和上下文关联。

注意事项：
-   保持描述简洁明了，避免重复和冗余。
-   每个部分控制在2-3句话以内。
-   使用准确的科学术语。
-   避免主观推测和过度解读。

请用清晰、简洁的中文学术语言输出结构化描述。
"""
